function Class(){}function capitalize(e){return e.charAt(0).toUpperCase()+e.slice(1)}function isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}Class.prototype.construct=function(){},Class.__asMethod__=function(t,n){return function(){var e=this.$;this.$=n;var i=t.apply(this,arguments);return this.$=e,i}},Class.extend=function(e){var i=function(){arguments[0]!==Class&&this.construct.apply(this,arguments)},t=new this(Class),n=this.prototype;for(var a in e){var o=e[a];o instanceof Function&&(o=Class.__asMethod__(o,n)),t[a]=o}return t.$=n,i.prototype=t,i.extend=this.extend,i},$.fn.highlight=function(e){return this.length&&e&&e.length?this.each(function(){!function e(i,t){var n=0;if(3==i.nodeType){var a=i.data.toUpperCase().indexOf(t);if(0<=(a-=i.data.substr(0,a).toUpperCase().length-i.data.substr(0,a).length)){var o=document.createElement("span");o.className="highlight";var r=i.splitText(a);r.splitText(t.length);var s=r.cloneNode(!0);o.appendChild(s),r.parentNode.replaceChild(o,r),n=1}}else if(1==i.nodeType&&i.childNodes&&!/(script|style)/i.test(i.tagName))for(var l=0;l<i.childNodes.length;++l)l+=e(i.childNodes[l],t);return n}(this,e.toUpperCase())}):this},$.fn.searchAble=function(t){var n="",a="",o=this,r=o.next(".glyphicon-remove");r.click(function(){o.val(""),o.trigger("keyup")}),o.on("keyup",function(e){var i=o.val();""==i?r.hide():r.show(),e.keyCode!=keyCode.ENTER?(n=i,setTimeout(function(){i==n&&i!=a&&t(a=i)},500)):t(a=i)})},$.fn.serializeObject=function(){var e={},i=this.serializeArray();return $.each(i,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e};var keyCode={BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38,SHIFT:16,S:83},KikCmsClass=Class.extend({baseUri:null,translations:{},errorMessages:{},isDev:!1,maxFileUploads:null,maxFileSize:null,maxFileSizeString:null,windowManager:null,renderables:{},init:function(){"undefined"!=typeof moment&&moment.locale($("html").attr("lang"));var e=JSON.parse($("#kikCmsJsSettings").val());for(var i in e)this[i]=e[i];$("body").on("mouseover",".tt-suggestion",function(){$(".tt-suggestion").removeClass("tt-cursor"),$(this).addClass("tt-cursor")}),"undefined"!=typeof WindowManager&&(this.windowManager=new WindowManager)},initRenderables:function(n){var a=this;n=void 0!==n?n:null,$("[data-renderable]").each(function(){var e=$(this);if("true"!=e.attr("data-rendered")){var i=$.parseJSON(e.attr("data-renderable")),t=i.properties.renderableInstance;a.renderables[t]=new window[i.class],$.each(i.properties,function(e,i){a.renderables[t][e]=i}),n&&(a.renderables[t].parent=n),a.renderables[t].init(),e.attr("data-rendered",!0)}})},action:function(e,i,n,t,a,o){var r=!1,s=this,l=0;o=void 0!==o?o:null,setTimeout(function(){0==r&&KikCMS.showLoader()},250);var d=$("html").attr("lang");d&&(i.activeLangCode=d);var c={url:e,type:"post",dataType:"json",data:i,cache:!1,success:function(e,i,t){r=!0,s.hideLoader(),n(e,i,t),s.initRenderables(o)},error:function(e){if(0==e.readyState&&0==e.status&&l<2)return l++,void u();r=!0,s.showError(e,t)}};void 0!==a&&a&&(c.cache=!1,c.contentType=!1,c.processData=!1,c.xhr=a);var u=function(){$.ajax(c)};u()},getSecurityToken:function(i){KikCMS.action("/cms/generate-security-token",{},function(e){i(e)})},showError:function(e,i){void 0!==i&&i(),this.hideLoader(),this.isDev&&440!=e.status?$("#ajaxDebugger").html(e.responseText).show():alert(e.responseJSON.title+"\n\n"+e.responseJSON.description)},showLoader:function(){this.getLoader().addClass("show")},hideLoader:function(){this.getLoader().removeClass("show")},getLoader:function(){return $("#cmsLoader")},removeExtension:function(e){return e.replace(/\.[^/.]+$/,"")},tl:function(e,i){var t=this.translations[e];return $.each(i,function(e,i){t=t.replace(new RegExp(":"+e,"g"),i)}),t},toSlug:function(e){e=e.replace(/^\s+|\s+$/g,"").toLowerCase();for(var i="àáäâèéëêìíïîòóöôùúüûñç·/_,:;",t=0,n=i.length;t<n;t++)e=e.replace(new RegExp(i.charAt(t),"g"),"aaaaeeeeiiiioooouuuunc------".charAt(t));return e=e.replace(/[^a-z0-9 -]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-")}}),KikCMS=new KikCmsClass;$(function(){KikCMS.init(),KikCMS.initRenderables()});var WebForm=Class.extend({renderableInstance:null,renderableClass:null,parent:null,openFilePickerWindow:function(i){var t=this;this.getFilePickerWindow().on("click",".buttons .cancel",function(){t.closeFilePickerWindow(i)}),KikCMS.action("/cms/webform/getFinder",{},function(e){t.initFilePickerWindow(e.finder,i)})},actionPreview:function(e,i,t,n){var a=e.find(".preview"),o=e.find(".preview .thumb"),r=e.find(".buttons .pick"),s=e.find(".buttons .delete"),l=e.find(".filename");t.dimensions?(o.css("width",t.dimensions[0]/2),o.css("height",t.dimensions[1]/2)):(o.css("width","auto"),o.css("height","auto")),a.removeClass("hidden"),o.html(t.preview),l.html("("+t.name+")"),e.find(" > input[type=hidden].fileId").val(i),r.addClass("hidden"),s.removeClass("hidden"),void 0!==n&&n()},actionPickFile:function(i,t,n){var a=this;KikCMS.action("/cms/webform/filepreview/"+t,{},function(e){a.actionPreview(i,t,e,n)})},closeFilePickerWindow:function(e){var i=this.getUploadButtonForFileField(e),t=this.getFilePickerWindow();KikCMS.windowManager.closeWindow(t,function(){i.removeClass("disabled")})},init:function(){this.initAutocompleteFields(),this.initDateFields(),this.initFileFields(),this.initWysiwyg(),this.initPopovers()},initAutocompleteFields:function(){var n=this;this.getWebForm().find(".autocomplete").each(function(){var i=$(this),e=i.attr("data-field-key"),t=i.attr("data-route");KikCMS.action(t,{field:e,renderableInstance:n.renderableInstance,renderableClass:n.renderableClass},function(e){var a;i.typeahead({hint:!0,highlight:!0},{limit:10,source:(a=e,function(e,i){var t=[],n=new RegExp(e,"i");$.each(a,function(e,i){n.test(i)&&t.push(i)}),i(t)})})})})},initDateFields:function(){this.getWebForm().find(".type-date input").each(function(){var e=$(this);if(e.datetimepicker({format:e.attr("data-format"),locale:moment.locale(),useCurrent:!1}),e.attr("data-default-date")){var i=e.val(),t=moment(e.attr("data-default-date"),e.attr("data-format"));e.datetimepicker("defaultDate",t),i||e.val("")}})},initFileFields:function(){var s=this;this.getWebForm().find(".type-file").each(function(){var e=$(this),i=e.find(".file-picker"),t=e.find(".btn.upload"),n=e.find(".btn.delete"),a=e.find(".btn.pick"),o=e.find(".btn.preview"),r=e.find(".btn.pick, .btn.preview");s.initUploader(e),n.click(function(){e.find(".filename").html(""),e.find(" > input[type=hidden].fileId").val(""),a.removeClass("hidden"),n.addClass("hidden"),o.find("img").remove(),o.addClass("hidden")}),r.click(function(){if(0!=$(this).attr("data-finder"))return 1<=i.find(".finder").length?(i.slideToggle(),void t.toggleClass("disabled")):void s.openFilePickerWindow(e)})})},initFilePickerWindow:function(e,t){var n=this,i=this.getFilePickerWindow(),a=i.find(".windowContent");a.html(e),a.unbind("pick"),a.unbind("selectionChange");var o=i.find(".pick-file");KikCMS.windowManager.showWindow(i),this.initFilePickerWindowSize(),$(window).resize(this.initFilePickerWindowSize.bind(this)),a.on("pick",".file",function(e,i){n.onPickFile($(this),t,i)}),a.on("selectionChange",".file",function(){1<=a.find(".file.selected:not(.folder)").length?o.removeClass("disabled"):o.addClass("disabled")}),o.click(function(){o.hasClass("disabled")||n.onPickFile(a.find(".file.selected"),t)})},initFilePickerWindowSize:function(){var e=this.getFilePickerWindow(),i=e.find(".windowContent > .footer"),t=e.find(".windowContent > .header"),n=e.height(),a=t.outerHeight(),o=i.outerHeight();e.find(".files").css("height",n-a-o-132)},initPopovers:function(){this.getWebForm().find('[data-toggle="popover"]').each(function(){var e=$(this).attr("data-content");$(this).popover({placement:"auto bottom",html:!0,content:e,container:"body"})})},initTinyMCE:function(){var i=this;tinymce.init({selector:this.getWysiwygSelector(),setup:function(e){e.on("change",function(){tinymce.triggerSave()})},language_url:"/cmsassets/tinymce/"+KikCMS.tl("system.langCode")+".js",language:KikCMS.tl("system.langCode"),theme:"modern",relative_urls:!1,remove_script_host:!0,document_base_url:KikCMS.baseUri,plugins:["advlist autolink lists link image charmap print preview hr anchor pagebreak searchreplace visualblocks","visualchars code insertdatetime media nonbreaking save table contextmenu directionality template paste","textcolor colorpicker textpattern codesample toc"],image_advtab:!0,content_css:["/cmsassets/css/tinymce_content.css"],link_list:this.getLinkListUrl(),file_picker_callback:function(e){i.getFilePicker(e)}})},initUploader:function(i){var t=this;new FileUploader({$container:i,action:"/cms/webform/uploadAndPreview",addParametersBeforeUpload:function(e){return e.append("folderId",i.find(".btn.upload").attr("data-folder-id")),e.append("renderableInstance",t.renderableInstance),e.append("renderableClass",t.renderableClass),e},onSuccess:function(e){e.fileId&&t.actionPreview(i,e.fileId,e)}}).init()},initWysiwyg:function(){var e=this;0!=$(this.getWysiwygSelector()).length&&("undefined"==typeof tinymce?$.getScript("//cdn.tinymce.com/4/tinymce.min.js",function(){window.tinymce.dom.Event.domLoaded=!0,tinymce.baseURL="//cdn.tinymce.com/4",tinymce.suffix=".min",e.initTinyMCE()}):this.initTinyMCE())},getFilePicker:function(t){var i=function(i){var e=i.attr("data-id");KikCMS.action("/cms/file/url/"+e,{},function(e){t(e.url,{alt:i.find(".name span").text()}),n.close()})},e=this.getWindowHeight()<768?this.getWindowHeight()-130:768,n=tinymce.activeEditor.windowManager.open({title:"Image Picker",url:"/cms/filePicker",width:952,height:e,buttons:[{text:"Insert",onclick:function(){var e=$(n.$el).find("iframe")[0].contentWindow.$(".filePicker").find(".file.selected");if(!e.length)return!1;i(e)}},{text:"Close",onclick:"close"}]});n.on("open",function(){$(n.$el).find("iframe").on("load",function(){this.contentWindow.$(".filePicker").on("pick",".file",function(){i($(this))})})})},getFilePickerWindow:function(){return KikCMS.windowManager.getWindow("finder",this.getWebForm())},getLinkListUrl:function(){var e="/cms/getTinyMceLinks/";return this.parent&&this.parent.getWindowLanguageCode()?e+this.parent.getWindowLanguageCode()+"/":e},getWebForm:function(){return $("[data-instance="+this.renderableInstance+"]")},getWindowHeight:function(){return $(window).height()},getWysiwygSelector:function(){return"#"+this.getWebForm().attr("id")+" textarea.wysiwyg"},getUploadButtonForFileField:function(e){return e.find(".btn.upload")},removeExtension:function(e){return e.replace(/\.[^/.]+$/,"")},onPickFile:function(e,i,t){var n=e.attr("data-id"),a=this.getUploadButtonForFileField(i);e.removeClass("selected"),a.removeClass("disabled"),this.actionPickFile(i,n,t),this.closeFilePickerWindow(i)}});